---
layout: post
title: "마지막 미션, 모라고라(체크메이트) 마이그레이션"
subtitle: "..."
date: 2022-12-20 10:00:00 +0900
categories: backend
tags: wooteco
comments: true
published: true
---

## 개요

마지막으로 개인적으로 주어진 미션이 있다.

우아한테크코스에서 했던 팀 프로젝트를 마이그레이션 하기.

테크코스가 끝나고 정말 귀신같이 매일 잠과 휴식을 탐하면서, 부족한 비타민을 채우듯이 쉬었다.

후반으로 갈 수록 재미보다는 힘들다는 느낌이 컸었던 것 같다.

지금은 완충이 되어, 백업 및 EC2 생성 정도만 해두었던 팀 프로젝트를 옮기고자 한다.


## 팀 프로젝트 옮기기 전 사전 준비

> 이건 오늘 이전에 이미 했었던 과정이다.

### 1. 파일 백업

서버는 대략 20개가 조금 안 되었다. 

이렇게 많은 서버를 가진 이유는 아래와 같다.

- 우선 프로덕션과 개발 서버를 분리가 되었다.

- 그리고 WS 셋업된 EC2가 Front와 Back을 나누어 있다.

- 로드밸런싱된 2대의 WAS가 있다. 

- 별도의 소나큐브 서버 (굉장히 무겁기 떄문에 따로 분리)

- Jenkins, CI 서버 2대 (Front, Back)
  - 이것 역시 무겁기도 하고, 특히 프론트 배포시 서버가 거의 멈추는 일까지 일어난다.

- 프로메테우스 및 그라파나 (성능 분석 및 시각화)

- 로커스트 (부하 생성기)

... 이러다 보니까 서버가 무려 20개 가까이 되었다.

따라서 자잘한 프로그램 셋업 과정이 전체 다를 백업하지는 못하고 내가 손대지 않은 부분만 History로 뺴왔다.

그리고 젠킨스 같은 경우 공을 들인 부분이 많아서, shell script의 경우 거의 다 백업해왔다.

### 2. EC2 생성

- 개인 계정으로 서버를 생성했다.


## 마이그레이션 하기

### 도커?

혹시나 그럴 일이 있을 지는 모르지만 필요한 팀원이 있을 경우, 서버 통쨰로 제공할 수 있으면 좋을 것 같다는 생각에 도커를 기반으로 시작했다.

그러나 정작 필자가 도커에 대해 잊은 사항이 많아서 복습을 하면서 진행했다...

### 도커 이미지 고르기

처음에는 WAS가 필요하면 JDK가 설치된 도커를, Nginx가 필요하면 이에 관한 공식 이미지를 찾았다.

개인적으로는 이런 경우 불편했던 것이... Ubuntu가 아닌 다른 무엇으로 설치되는 경우가 있었다. 이게 상당히 불편하다.

특히 데비안 계열이 아닌 경우 특정 프로그램을 사용하지 못하는 것도 있고, 시스템의 특성상 설치가 안 되는 프로그램도 있었다.

따라서 `Ubuntu:22.04` 에 해당하는 이미지를 베이스로 작업하기로 결정했다.

### 여러 대의 도커 컨테이너?

이것 또한 관리상 불편하다고 생각 되었다. 컨테이너를 분리해서 관리하면, 이미지로 백업해두어서 서랍장 분리하듯 역할이 보여서 편할 거라 생각했다.

그러나 이럴 경우 컨테이너 간 네트워킹을 해야 점도 있고 이미지 자체가 분할 되어, 이미지 간의 연관 관계를 생각하면서 작업해야할 것 같단 생각이 들었다.

**따라서 서비스 하나에 대해 하나의 컨테이너만을 사용하기로 결정헀다**

