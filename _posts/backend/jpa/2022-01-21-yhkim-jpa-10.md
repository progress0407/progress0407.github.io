---
layout: post
title: "[김영한 - JPA 기본] #10 JPQL - 1"
subtitle: "..."
date: 2022-01-21 00:30 +0900
categories: backend
tags: jpa
comments: true
---

## JPQL 소개

- JPA Criteria, QueryDSL은 자바코드를 짜서 JPQL을 빌드해주는 제네레이터 클래스의 모임

  - `JPQL` 이 위 두 문법의 근간이다 !!

- 예를 들어 `나이가 18살 이상`인 회원을 검색하고 싶다면?  
  과 같은 조건이 들어간 쿼리를 하고 싶을 때

- 테이블이 아닌 객체를 대상으로 검색한다

- SQL과 문법 유사, SELECT, FROM, WHERE, GROUP BY, HAVING, JOIN 지원한다

- SQL을 추상화해서 특정 DB SQL 문법 (방언, Dialect) 에 의존하지 않는다

### JPQL 예시 코드

> 예시 1

```java
String jpql = "select f from Folder as f where f.name like 'folder%' ";
List<Folder> folders = em.createQuery(jpql, Folder.class).getResultList();
```

> 실행된 SQL

```sql
/* select
        f
    from
        Folder as f
    where
        f.name like 'folder%'  */ select
            folder0_.id as id1_2_,
            folder0_1_.IS_HIDDEN as IS_HIDDE2_2_,
            folder0_1_.name as name3_2_,
            folder0_1_.PARENT_ID as PARENT_I4_2_,
            folder0_.IS_SHARED as IS_SHARE1_3_
        from
            Folder folder0_
        inner join
            File folder0_1_
                on folder0_.id=folder0_1_.id
        where
            folder0_1_.name like 'folder%'
```

> 예시 2

```java
String jpql = "select b from BookMark as b where b.size >= 10 ";
List<BookMark> bookMarkList = em.createQuery(jpql, BookMark.class).getResultList();
bookMarkList.forEach(out::println);
```

> 실행된 SQL

```sql
/* select
        b
    from
        BookMark as b
    where
        b.size >= 10  */ select
            bookmark0_.id as id1_2_,
            bookmark0_1_.IS_HIDDEN as IS_HIDDE2_2_,
            bookmark0_1_.name as name3_2_,
            bookmark0_1_.PARENT_ID as PARENT_I4_2_,
            bookmark0_.size as size1_1_,
            bookmark0_.url as url2_1_
        from
            BookMark bookmark0_
        inner join
            File bookmark0_1_
                on bookmark0_.id=bookmark0_1_.id
        where
            bookmark0_.size>=10
```

### JPA Criteria

- JPQL 빌더 중 하나

- JPA 공식 스펙으로 문자열 코딩이 아닌 자바로 JPQL 쿼리문 작성 가능

- 단점 : **너무 복잡**하다, 작성하고서도 읽기 힘든 유지보수 힘듬

- `QueryDSL` 사용 권장

### 네이티브 SQL 소개

> 예시

```java
List resultList = em.createNativeQuery("SELECT ID, NAME FROM FILE").getResultList();
```

> 발생 쿼리

```sql
/* dynamic native SQL query */ SELECT
    ID,
    NAME
FROM
    FILE
```

> 참고로 영한님은 JPA에서 제공하는 위 API보다는 SpringJdbcTemplate을 주로 사용한다고 하신다 !

### JDBC, 스프링 JdbcTemplate, 마이바티스

그 외 위와 같이 JDBC를 직접 연결하거나 등의 사용법으로 사용 가능한데

이떄 적절하게 영속성 컨텍스트를 직접 `flush` 해주지 않으면 원하는 결과를 얻을 수 없을 떄가 있다

예를들어 한 트랜잭션 안에 insert 후 native하게 select 해올 때
